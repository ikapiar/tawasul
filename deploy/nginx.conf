server {
    listen 80;

    # Root directory for your built React files (e.g., the 'build' or 'dist' folder)
    root /apps/tawasul/www;

    index index.html index.htm;

    # --- API Proxy Configuration ---
    # Intercepts all requests starting with /api/v1/
    location /api/v1/ {
        # Define the backend server address
        proxy_pass http://localhost:3000/api/v1/;

        # Optional: Set necessary headers for the backend API
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location / {
        # Try serving the requested URI as a file, then as a directory,
        # and finally fall back to index.html for client-side routing
        try_files $uri $uri/ /index.html;
    }

    # Optional: Configuration for performance optimization
    brotli on;
    brotli_comp_level 11;
    brotli_static on;
    brotli_types text/plain text/css application/javascript application/x-javascript text/xml
    application/xml application/xml+rss text/javascript image/x-icon
    image/vnd.microsoft.icon image/bmp image/svg+xml;

    # Optional: Caching headers for static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|woff|woff2|ttf|svg)$ {
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }
}